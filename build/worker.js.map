{"version":3,"file":"worker.js","sources":["../src/server/app/connections.js","../src/server/constants.js","../src/server/app/feed.js","../src/server/app/user.js","../src/server/app/index.js","../src/server/mongoConfig.js","../src/server/worker.js"],"sourcesContent":["import mongoose from 'mongoose'\nimport { EventEmitter } from 'events'\nimport util from 'util'\n\nfunction Connector({ host, database, port, user, password }) {\n  EventEmitter.call(this)\n\n  const uri = `mongodb://${user}:${password}@${host}:${port}/${database}`\n  const opts = { keepAlive: 1, useCreateIndex: true, useNewUrlParser: true, useFindAndModify: false };\n  this.db = mongoose.createConnection(uri, opts)\n  .on('connected', () => {\n    console.log({ type: 'info', msg: 'connected', service: 'mongodb', uri })\n    this.emit('ready')\n  })\n  .on('error', (err) => {\n    console.log({ type: 'error', msg: err, service: 'mongodb' })\n  })\n  .on('close', () => {\n    console.log({ type: 'error', msg: 'closed', service: 'mongodb' })\n  })\n  .on('disconnected', () => {\n    console.log({ type: 'error', msg: 'disconnected', service: 'mongodb' })\n    this.emit('lost')\n  })\n}\n\nutil.inherits(Connector, EventEmitter)\n\nexport default function (mongoUrl) {\n  return new Connector(mongoUrl)\n}\n","export const FEED_URL = 'http://www.ndbc.noaa.gov/rss/ndbc_obs_search.php'\nexport const LAT_RE = new RegExp(/(^[0-9]{1,2})(N|S)/)\nexport const LON_RE = new RegExp(/(^[0-9]{1,3})(E|W)/)\n","import { parseString } from 'xml2js'\nimport axios from 'axios'\nimport mongoose, { Schema } from 'mongoose'\n\nimport { FEED_URL } from '../constants'\n\nmongoose.Promise = global.Promise\n\nexport default function createFeed({ connection }) {\n  const feedSchema = new Schema({\n    title: String,\n    pubDate: String,\n    description: String,\n    lat: String,\n    lon: String,\n    items: [{\n      pubDate: String,\n      title: String,\n      description: String,\n      link: String,\n      guid: String,\n      data: {\n        pubDate: String,\n        location: String,\n        windDirection: String,\n        windSpeed: String,\n        windGust: String,\n        significantWaveHeight: String,\n        dominantWavePeriod: String,\n        averagePeriod: String,\n        meanWaveDirection: String,\n        atmosphericPressure: String,\n        pressureTendency: String,\n        airTemperature: String,\n        waterTemperature: String,\n      },\n    }],\n  })\n\n  feedSchema.statics = {\n    pullFeed(coords) {\n      const Feed = this\n\n      function descriptionToData(description) {\n        const gimmeKey = mess => mess.replace('<strong>', '').replace(':', '')\n        const gimmeVal = mess => mess.replace('<br />', '').trim()\n        const camelize = text => `${text.charAt(0).toLowerCase()}${text.slice(1)}`.replace(/ /g, '')\n        const decode = text => text.replace(/&#(\\d+);/g, (_, d) => String.fromCharCode(d))\n        return description\n          .trim()\n          .split('\\n')\n          .map(t => t.trim())\n          .map(f => f.split('</strong>'))\n          .map(p => ([gimmeKey(p[0]), gimmeVal(p[1])]))\n          .reduce((acc, pair, i) => {\n            const data = i ? { [camelize(pair[0])]: decode(pair[1]) } : { pubDate: pair[0] }\n            return Object.assign({}, acc, data)\n          }, {})\n      }\n\n      function getItemProps(item) {\n        const { pubDate, title, description, link, guid } = item\n        const [lat, lon] = item['georss:point'][0].split(' ')\n        return {\n          guid: guid[0]._.split('-')[1],\n          pubDate: pubDate[0],\n          title: title[0],\n          data: descriptionToData(description[0]),\n          link: link[0],\n          coordinates: { lat, lon },\n        }\n      }\n\n      function parseFeed(xml) {\n        console.log('parsing feed')\n        return new Promise((resolve, reject) => (\n          parseString(xml, (error, result) => {\n            if (error) {\n              console.log(error)\n              return reject(error)\n            }\n\n            const feed = result.rss.channel[0]\n            return resolve({\n              title: feed.title[0],\n              pubDate: feed.pubDate[0],\n              description: feed.description[0],\n              items: feed.item.map(getItemProps),\n            })\n          })\n        ))\n      }\n\n      function fetchFeed({ lat, lon }) {\n        console.log(`Fetching buoys within 100 mi of ${lat}, ${lon}`)\n        const params = { lat, lon, radius: 100 }\n        return axios(FEED_URL, { params }).then(res => res.data)\n      }\n\n      function saveFeed(data) {\n        return new Promise((resolve, reject) => {\n          const { lat, lon } = coords\n          const { title, description, pubDate, items } = data\n          if (!items.length) reject('no_items')\n\n          console.log('saving feed', { title, description, pubDate })\n          const cb = (err, feed) => (err ? reject(err) : resolve(feed))\n          Feed.findOneAndUpdate({ lat, lon }, data, { upsert: true }, cb)\n        })\n      }\n\n      return fetchFeed(coords)\n        .then(parseFeed)\n        .then(saveFeed)\n        .catch(err => console.log(err))\n    },\n  }\n\n  return connection.model('Feed', feedSchema)\n}\n","import mongoose, { Schema } from 'mongoose'\nimport bcrypt from 'bcrypt'\n\nmongoose.Promise = global.Promise\n\nexport default function CreateUser({ connection }) {\n  const userSchema = new Schema({\n    favorites: { type: [String], default: [] },\n    username: { type: String, unique: true, required: true, trim: true },\n    password: { type: String, required: true },\n  })\n\n  userSchema.statics = {\n    authenticate({ username, password }) {\n      return this.findOne({ username })\n        .exec()\n        .then((user) => {\n          return bcrypt.compare(password, user.password)\n          .then(res => (res ? user : Promise.reject('bad creds')))\n        })\n    },\n\n    listFavorites(_id) {\n      return this.findOne({ _id })\n        .exec()\n        .then(user => (user ? user.favorites : []))\n    },\n\n    addFavorite(_id, buoy) {\n      return this.findOneAndUpdate({ _id }, { $addToSet: { favorites: buoy } }, { upsert: true })\n        .exec()\n    },\n\n    removeFavorite(_id, buoy) {\n      return this.findOneAndUpdate({ _id }, { $pull: { favorites: buoy } })\n        .exec()\n    },\n  }\n\n  userSchema.pre('save', function (next) {\n    const user = this\n    bcrypt.hash(user.password, 10, (err, hash) => {\n      if (err) return next(err)\n      user.password = hash\n      return next()\n    })\n  })\n\n  return connection.model('User', userSchema)\n}\n","import { EventEmitter } from 'events'\nimport util from 'util'\nimport connections from './connections'\nimport FeedModel from './feed'\nimport UserModel from './user'\n\nfunction App(config) {\n  EventEmitter.call(this)\n\n  this.config = config\n  this.connections = connections(config.mongoConfig)\n  this.connections.once('ready', this.onConnected.bind(this))\n  this.connections.once('lost', this.onLost.bind(this))\n}\n\nutil.inherits(App, EventEmitter)\n\n// Connections\nApp.prototype.onConnected = function () {\n  this.Feed = FeedModel({ connection: this.connections.db })\n  this.User = UserModel({ connection: this.connections.db })\n  this.emit('ready')\n}\n\nApp.prototype.onLost = function () {\n  console.log('app lost')\n  this.emit('lost')\n}\n\n// Feed\nApp.prototype.createFeed = function ({ lat, lon }) {\n  this.Feed.find({ lat, lon })\n    .exec()\n    .then((feed) => {\n      if (!feed.length) return this.Feed.pullFeed({ lat, lon })\n      return feed\n    })\n}\n\nApp.prototype.updateFeeds = function () {\n  this.Feed.find({}, 'lat lon')\n    .exec()\n    .then((feeds) => {\n      // We create the default feed if none exists\n      if (!feeds.length) return this.createFeed({ lat: '40N', lon: '73W' })\n      return feeds.forEach(f => this.Feed.pullFeed(f))\n    })\n    .catch(err => console.log(err))\n}\n\nApp.prototype.getFeed = function (coords) {\n  return this.Feed.findOne(coords, 'description items')\n    .exec()\n    .then((feed) => {\n      if (!feed) return Promise.reject('not_found')\n      return feed\n    })\n}\n\n// User\nApp.prototype.createUser = function (creds) {\n  return this.User.create(creds)\n}\n\nApp.prototype.authenticate = function (creds) {\n  return this.User.authenticate(creds)\n}\n\nApp.prototype.listFavorites = function (id) {\n  return this.User.listFavorites(id)\n}\n\nApp.prototype.addFavorite = function (id, buoy) {\n  return this.User.addFavorite(id, buoy)\n}\n\nApp.prototype.removeFavorite = function (id, buoy) {\n  return this.User.removeFavorite(id, buoy)\n}\n\nexport default function (config) {\n  return new App(config)\n}\n","require('dotenv').load()\n\nexport default {\n  user: process.env.MONGO_USER || '',\n  password: process.env.MONGO_PASSWORD || '',\n  host: process.env.MONGO_HOST || 'localhost',\n  port: process.env.MONGO_PORT || '27017',\n  database: process.env.MONGO_DB || '',\n}\n","require('dotenv').load()\n/* eslint-disable import/first */\nimport app from './app'\nimport { FEED_URL } from './constants'\nimport mongoConfig from './mongoConfig'\n\nrequire('source-map-support').install()\n\nconst refreshInterval = process.env.FEED_REFRESH_INTERVAL || 60\nconst instance = app({ mongoConfig, url: FEED_URL })\n\nfunction start() {\n  console.log({ type: 'info', msg: 'starting worker' })\n\n  function shutdown() {\n    console.log({ type: 'info', msg: 'shutting down' })\n    process.exit()\n  }\n\n  if (process.env.NODE_ENV === 'production') process.send('ready')\n  instance.on('lost', shutdown)\n  instance.updateFeeds()\n  setInterval(() => instance.updateFeeds(), refreshInterval * 60 * 1000)\n\n  process.on('SIGTERM', shutdown)\n}\n\ninstance.on('ready', start)\n"],"names":["EventEmitter","const","mongoose","this","Schema","parseString","FeedModel","UserModel"],"mappings":"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"}